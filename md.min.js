// [html.md](http://neocotic.com/html.md) 1.0.0  
// (c) 2012 Alasdair Mercer  
// Freely distributable under the MIT license.  
// Based on [Make.text](http://homepage.mac.com/tjim/) 1.5  
// (c) 2007 Trevor Jim  
// Licensed under the GPL Version 2 license.  
// For all details and documentation:  
// <http://neocotic.com/html.md>
(function(){function u(a){m!=null&&(g+=m),m=a}function v(){u("  "+n),d=e=!0}function w(){var a=j;return j=!0,function(){j=a}}function x(a){return a.replace(/`/g,"\\`")}function y(a){a=a.replace(/\n([ \t]*\n)+/g,"\n"),a=a.replace(/\n[ \t]+/g,"\n"),a=a.replace(/[ \t]+/g," ");for(var d in b)b.hasOwnProperty(d)&&(a=a.replace(c[d],b[d]));return a}function z(){var a=l;return l=!0,function(){l=a}}function A(a){if(!a)return;k||(e?a=a.replace(/^[ \t\n]+/,""):/^[ \t]*\n/.test(a)?a=a.replace(/^[ \t\n]+/,"\n"):a=a.replace(/^[ \t]+/," "));if(a==="")return;f=/\n\n$/.test(a),d=/\n$/.test(a),e=/[ \t\n]$/.test(a),u(a.replace(/\n/g,n))}function B(a){return function(){A(a)}}function C(){if(f)return;d||(u(n),d=!0),u(n),e=f=!0}function D(){var a=k;return k=!0,function(){k=a}}function E(a){if(typeof getComputedStyle!="undefined")try{var b=getComputedStyle(a,null);if(b&&b.getPropertyValue&&b.getPropertyValue("display")==="none")return}catch(c){I(c,"getComputedStyle")}if(a.nodeType===t.ELEMENT_NODE){var d=null,f=null,g=null,i=!1;try{switch(a.tagName){case"HEAD":case"STYLE":case"SCRIPT":case"SELECT":case"OPTION":case"NOSCRIPT":case"NOFRAMES":case"INPUT":case"BUTTON":case"SELECT":case"TEXTAREA":case"LABEL":i=!0;break;case"BODY":case"FORM":break;case"H1":C(),A("# ");break;case"H2":C(),A("## ");break;case"H3":C(),A("### ");break;case"H4":C(),A("#### ");break;case"H5":C(),A("##### ");break;case"H6":C(),A("###### ");break;case"P":case"DIV":C();break;case"BR":v();break;case"HR":C(),A("--------------------------------"),C();break;case"EM":case"I":case"U":A("_"),e=!0,d=B("_");break;case"DT":C();case"STRONG":case"B":A("**"),e=!0,d=B("**");break;case"OL":f=F("    "),g=z(),d=function(){f(),g()};break;case"UL":f=F("    "),g=J(),d=function(){f(),g()};break;case"LI":l?G("1.  "):G("*   ");break;case"PRE":f=F("    "),g=D(),d=function(){f(),g()};break;case"CODE":k||(A("`"),f=w(),g=B("`"),d=function(){f(),g()});break;case"DD":case"BLOCKQUOTE":d=F("> ");break;case"A":if(!a.href)break;var m;r[a.href]?m=r[a.href]:(m=o.length,o[m]=a.href,r[a.href]=m,a.title&&(p[m]=a.title)),A("["),e=!0,d=B("]["+m+"]");break;case"IMG":i=!0;if(!a.src)break;A("!["+a.alt+"]("+a.src+")");break;case"IFRAME":case"FRAME":i=!0;try{a.contentDocument&&a.contentDocument.documentElement&&E(a.contentDocument.documentElement)}catch(c){I(c,"contentDocument")}break;case"TR":d=C;break;default:h.debug&&(s[a.tagName]=null)}}catch(c){I(c,a.tagName)}if(!i)for(var n=0;n<a.childNodes.length;n++)E(a.childNodes[n]);d&&d()}else a.nodeType===t.TEXT_NODE&&(k?A(a.nodeValue):j?A(x(a.nodeValue)):A(y(a.nodeValue)))}function F(a){var b=n;return n+=a,f?u(a):C(),function(){n=b,d=f=!1,C()}}function G(a){d?m&&(m=m.replace(/[ ]{4}$/,a)):(u(n.replace(/[ ]{4}$/,a)),d=e=f=!0)}function H(b){d=!0,e=!0,f=!0,g="",i=[],j=!1,k=!1,l=!1,m=null,n="\n",o=[],p=[],r={},s={},typeof b!="object"&&(b={});for(var c in a)a.hasOwnProperty(c)&&(b.hasOwnProperty(c)?h[c]=b[c]:h[c]=a[c])}function I(a,b){h.debug&&i.push(b+": "+a)}function J(){var a=l;return l=!1,function(){l=a}}var a={debug:!1},b={"\\\\":"\\\\","\\[":"\\[","\\]":"\\]",">":"\\>",_:"\\_","\\*":"\\*","`":"\\`","#":"\\#","([0-9])\\.(\\s|$)":"$1\\.$2","©":"(c)","®":"(r)","™":"(tm)"," ":" ","·":"\\*"," ":" "," ":" "," ":" ","‘":"'","’":"'","“":'"',"”":'"',"…":"...","–":"--","—":"---"},c=function(){var a={};for(var c in b)b.hasOwnProperty(c)&&(a[c]=new RegExp(c,"g"));return a}(),d=!0,e=!0,f=!0,g="",h={},i=[],j=!1,k=!1,l=!1,m=null,n="\n",o=[],p=[],q=window.md,r={},s={},t=typeof t=="undefined"?{}:t;t.ELEMENT_NODE||(t.ELEMENT_NODE=1),t.TEXT_NODE||(t.TEXT_NODE=3);var K=window.md=function(a,b){if(!a)return"";H(b);var c=document.createElement("div");typeof a=="string"?c.innerHTML=a:c.appendChild(a),E(c),u("\n\n");var d;for(var e=0;e<o.length;e++)d="\n",p[e]&&(d=' "'+p[e]+'"\n'),o[e]&&u("["+e+"]: "+o[e]+d);if(h.debug){var f=[];for(var j in s)s.hasOwnProperty(j)&&f.push(j);f.sort(),f.length?console.log("Ignored tags;\n"+f.join(", ")):console.log("No tags were ignored"),i.length&&console.log(i.join("\n"))}return u(""),g};K.VERSION="1.0.0",K.noConflict=function(){return window.md=q,this}})();