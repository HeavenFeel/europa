/*! Europa v4.0.0 | (C) 2018 Alasdair Mercer, !ninja | MIT License */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Europa=e()}(this,function(){"use strict";var t="europaPluginStandardAnchor",e={startTag:function(t,e){return e.previousInCodeBlock=t.inCodeBlock,t.inPreformattedBlock?e.skipped=!0:(t.output("`"),t.inCodeBlock=!0),!0},endTag:function(t,e){e.skipped||(t.inCodeBlock=e.previousInCodeBlock,t.output("`"))}},n={startTag:function(t,e){e.previousWindow=t.window;var n=t.element.contentWindow;return n&&(t.window=n,t.convertElement(n.document.body)),!1},endTag:function(t,e){t.window=e.previousWindow}},r={startTag:function(t,e){var n=parseInt(t.tagName.match(/([1-6])$/)[1],10);t.appendParagraph();for(var r="",i=0;i<n;i++)r+="#";return t.output(r+" "),!0}},i="europaPluginStandardImage";var o={startTag:function(t,e){return t.appendParagraph(),!0}},a={plugins:[function(){return{converter:{A:{startTag:function(e,n){var r=e.element,i=e.options,o=i.absolute?r.href:r.getAttribute("href");if(!o)return!0;var a=e.context[t],u=a.anchorMap,s=a.anchors,c=r.getAttribute("title"),l=c?o+' "'+c+'"':o,f=void 0;return i.inline?n.value="("+l+")":(null==(f=u[l])&&(f=s.push(l)-1,u[l]=f),n.value="[anchor"+f+"]"),e.output("["),e.atNoWhiteSpace=!0,!0},endTag:function(t,e){null!=e.value&&t.output("]"+e.value)}}},startConversion:function(e){e.context[t]={anchorMap:{},anchors:[]}},endConversion:function(e){var n=e.context[t].anchors;if(n.length){e.append("\n\n");for(var r=0;r<n.length;r++)e.append("[anchor"+r+"]: "+n[r]+"\n")}}}},function(t){return{converter:{BLOCKQUOTE:t.getHelper("blockQuote")}}},function(t){var e=t.getHelper("bold");return{converter:{B:e,STRONG:e}}},function(){return{converter:{CODE:e,KBD:e,SAMP:e}}},function(t){return{converter:{DD:t.getHelper("blockQuote"),DT:{startTag:function(t,e){return t.appendParagraph(),t.output("**"),t.atNoWhiteSpace=!0,!0},endTag:function(t,e){t.output("**")}}}}},function(){return{converter:{DETAILS:{startTag:function(t,e){var n=t.element;if(t.appendParagraph(),n.hasAttribute("open"))return!0;var r=n.querySelector("summary");t.convertElement(r)}}}}},function(){return{converter:{FRAME:n,IFRAME:n}}},function(){return{converter:{H1:r,H2:r,H3:r,H4:r,H5:r,H6:r}}},function(){return{converter:{HR:{startTag:function(t,e){return t.appendParagraph().output("---").appendParagraph(),!1}}}}},function(){return{converter:{IMG:{startTag:function(t,e){var n=t.element,r=t.options,o=r.absolute?n.src:n.getAttribute("src");if(!o)return!1;var a=n.getAttribute("alt")||"",u=t.context[i],s=u.imageMap,c=u.images,l=n.getAttribute("title"),f=l?o+' "'+l+'"':o,p=void 0;return r.inline?f="("+f+")":(null==(p=s[f])&&(p=c.push(f)-1,s[f]=p),f="[image"+p+"]"),t.output("!["+a+"]"+f),!1}}},startConversion:function(t){t.context[i]={imageMap:{},images:[]}},endConversion:function(t){var e=t.context[i].images;if(e.length){t.append("\n\n");for(var n=0;n<e.length;n++)t.append("[image"+n+"]: "+e[n]+"\n")}}}},function(t){var e=t.getHelper("italic");return{converter:{CITE:e,DFN:e,EM:e,I:e,U:e,VAR:e}}},function(){return{converter:{BR:{startTag:function(t,e){return t.append("  "+t.left),t.atLeft=!0,t.atNoWhiteSpace=!0,!1}}}}},function(){return{converter:{LI:{startTag:function(t,e){var n=t.inOrderedList?t.listIndex+++". ":"* ";return t.atLeft?t.last&&(t.last=t.last.replace(/[ ]{2,4}$/,"\n")):(t.append(t.left.replace(/[ ]{2,4}$/,"\n")),t.atLeft=!0,t.atNoWhiteSpace=!0,t.atParagraph=!0),t.append(function(t,e,n){null==t&&(t=""),null==e&&(e=0);for(var r=0;r<e;r++)t=" "+t;return t}(n,2*(t.listDepth-1))),!0}},OL:{startTag:function(t,e){return e.previousInOrderedList=t.inOrderedList,e.previousListIndex=t.listIndex,0===t.listDepth&&t.appendParagraph(),t.inOrderedList=!0,t.listIndex=1,t.listDepth++,!0},endTag:function(t,e){t.inOrderedList=e.previousInOrderedList,t.listIndex=e.previousListIndex,t.listDepth--}},UL:{startTag:function(t,e){return e.previousInOrderedList=t.inOrderedList,e.previousListIndex=t.listIndex,0===t.listDepth&&t.appendParagraph(),t.inOrderedList=!1,t.listIndex=1,t.listDepth++,!0},endTag:function(t,e){t.inOrderedList=e.previousInOrderedList,t.listIndex=e.previousListIndex,t.listDepth--}}}}},function(){return{converter:{ADDRESS:o,ARTICLE:o,ASIDE:o,DIV:o,FIELDSET:o,FOOTER:o,HEADER:o,NAV:o,P:o,SECTION:o}}},function(){return{converter:{PRE:{startTag:function(t,e){return e.previousInPreformattedBlock=t.inPreformattedBlock,e.previousLeft=t.left,t.left+="    ",t.atParagraph?t.append("    "):t.appendParagraph(),!0},endTag:function(t,e){t.atLeft=!1,t.atParagraph=!1,t.inPreformattedBlock=e.previousInPreformattedBlock,t.left=e.previousLeft,t.appendParagraph()}}}}},function(){return{converter:{Q:{startTag:function(t,e){return t.output('"'),t.atNoWhiteSpace=!0,!0},endTag:function(t,e){t.output('"')}}}}}]};function u(t,e){if(t)for(var n in t)s(t,n)&&e(t[n],n,t)}function s(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var c={dom:{isVisible:function(t,e){var n=e.getComputedStyle(t);return"none"!==n.getPropertyValue("display")&&"hidden"!==n.getPropertyValue("visibility")}},forOwn:u,hasOwn:s,ownKeys:function(t){var e=[];return u(t,function(t,n){e.push(n)}),e}},l=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},f=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),p=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},h=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},d={"\\\\":"\\\\","\\[":"\\[","\\]":"\\]",">":"\\>",_:"\\_","\\*":"\\*","`":"\\`","#":"\\#","([0-9])\\.(\\s|$)":"$1\\.$2","©":"(c)","®":"(r)","™":"(tm)"," ":" ","·":"\\*"," ":" "," ":" "," ":" ","‘":"'","’":"'","“":'"',"”":'"',"…":"...","–":"--","—":"---"},v={},g=["APPLET","AREA","AUDIO","BUTTON","CANVAS","DATALIST","EMBED","HEAD","INPUT","MAP","MENU","METER","NOFRAMES","NOSCRIPT","OBJECT","OPTGROUP","OPTION","PARAM","PROGRESS","RP","RT","RUBY","SCRIPT","SELECT","STYLE","TEXTAREA","TITLE","VIDEO"].reduce(function(t,e){return t[e]=!0,t},{});c.forOwn(d,function(t,e){v[e]=new RegExp(e,"g")});var w=function(){function t(e,n,r){l(this,t),this.europa=e,this.options=n,this.atLeft=!0,this.atNoWhiteSpace=!0,this.atParagraph=!0,this.buffer="",this.context={},this.inCodeBlock=!1,this.inOrderedList=!1,this.inPreformattedBlock=!1,this.last=null,this.left="\n",this.listDepth=0,this.listIndex=1,this._document=e.document,this._element=null,this._pluginManager=r,this._tagName=null,this._window=e.window}return f(t,[{key:"append",value:function(t){return null!=this.last&&(this.buffer+=this.last),this.last=t,this}},{key:"appendParagraph",value:function(){return this.atParagraph?this:(this.atLeft||(this.append(this.left),this.atLeft=!0),this.append(this.left),this.atNoWhiteSpace=!0,this.atParagraph=!0,this)}},{key:"convertElement",value:function(t){if(t){var e=this._pluginManager,n=this.window;if(t.nodeType===n.Node.ELEMENT_NODE){if(!c.dom.isVisible(t,n))return;this.element=t;var r=this.tagName;if(g[r])return;var i={};if(!e.hasConverter(r)||e.invokeConverter(r,"startTag",this,i))for(var o=0;o<t.childNodes.length;o++)this.convertElement(t.childNodes[o]);e.invokeConverter(r,"endTag",this,i)}else if(t.nodeType===n.Node.TEXT_NODE){var a=t.nodeValue||"";this.inPreformattedBlock?this.output(a):this.inCodeBlock?this.output(a.replace(/`/g,"\\`")):this.output(a,!0)}}}},{key:"output",value:function(t,e){return t?(t=t.replace(/\r\n/g,"\n"),e&&(t=t.replace(/\n([ \t]*\n)+/g,"\n").replace(/\n[ \t]+/g,"\n").replace(/[ \t]+/g," "),c.forOwn(d,function(e,n){t=t.replace(v[n],e)})),this.inPreformattedBlock||(t=this.atNoWhiteSpace?t.replace(/^[ \t\n]+/,""):/^[ \t]*\n/.test(t)?t.replace(/^[ \t\n]+/,"\n"):t.replace(/^[ \t]+/," ")),t?(this.atLeft=/\n$/.test(t),this.atNoWhiteSpace=/[ \t\n]$/.test(t),this.atParagraph=/\n{2}$/.test(t),this.append(t.replace(/\n/g,this.left))):this):this}},{key:"replaceLeft",value:function(t){return this.atLeft?this.last&&(this.last=this.last.replace(/[ ]{2,4}$/,t)):(this.append(this.left.replace(/[ ]{2,4}$/,t)),this.atLeft=!0,this.atNoWhiteSpace=!0,this.atParagraph=!0),this}},{key:"toString",value:function(){return this.append("").buffer.trim()}},{key:"document",get:function(){return this._document}},{key:"element",get:function(){return this._element},set:function(t){this._element=t,this._tagName=t&&t.tagName?t.tagName.toUpperCase():null}},{key:"tagName",get:function(){return this._tagName}},{key:"window",get:function(){return this._window},set:function(t){this._window=t,this._document=t?t.document:null}}]),t}(),y=function(){function t(e,n){l(this,t),this.name=e,this._defaultValue=n}return f(t,[{key:"defaultValue",get:function(){var t=this._defaultValue;return"function"==typeof t?t.call(this):t}}]),t}(),m=function(){function t(e){l(this,t),this.options=e}return f(t,[{key:"exists",value:function(t){return this.options.some(function(e){return e.name===t})}},{key:"parse",value:function(t){t||(t={});var e={};return this.options.forEach(function(n){var r=n.name,i=null!=t[r]?t[r]:n.defaultValue;e[r]=i}),e}}]),t}(),P={blockQuote:function(){return{startTag:function(t,e){return e.previousLeft=t.left,t.left+="> ",t.atParagraph?t.append("> "):t.appendParagraph(),!0},endTag:function(t,e){t.atLeft=!1,t.atParagraph=!1,t.left=e.previousLeft,t.appendParagraph()}}},bold:function(){return{startTag:function(t,e){return t.output("**"),t.atNoWhiteSpace=!0,!0},endTag:function(t,e){t.output("**")}}},italic:function(){return{startTag:function(t,e){return t.output("_"),t.atNoWhiteSpace=!0,!0},endTag:function(t,e){t.output("_")}}}};var T={get:function(t,e){var n=P[t];if(!n)throw new ReferenceError("Unknown helper: "+t);return n(e)},list:function(){return c.ownKeys(P)}},k=function(){function t(){l(this,t)}return f(t,[{key:"getHelper",value:function(t,e){return T.get(t,e)}}]),t}(),E=function(){function t(){l(this,t),this._api=new k,this._converters={},this._plugins=[]}return f(t,[{key:"addPlugin",value:function(t){var e=this,n=t(this._api);return c.forOwn(n.converter,function(t,n){t&&(e._converters[n]=t)}),this._plugins.push(n),this}},{key:"addPreset",value:function(t){var e=this;return(t.plugins||[]).forEach(function(t){e.addPlugin(t)}),this}},{key:"hasConverter",value:function(t){return c.hasOwn(this._converters,t)}},{key:"invokeConverter",value:function(t,e){var n=this._converters[t];if(!n||"function"!=typeof n[e])return null;for(var r=arguments.length,i=Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];return n[e].apply(n,i)}},{key:"invokePlugins",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this._plugins.forEach(function(e){"function"==typeof e[t]&&e[t].apply(e,n)})}}]),t}(),_=function(){function t(){l(this,t),this._services={}}return f(t,[{key:"getService",value:function(t){var e=this._services[t];if(!e)throw new Error("Service is not being managed with name: "+t);return e}},{key:"setService",value:function(t,e){if(this._services[t])throw new Error("Service is already managed with name: "+t);e&&(this._services[t]=e)}}]),t}(),O=new E,b=new _,L=function(){function t(e){l(this,t),this._options=new m([new y("absolute",!1),new y("baseUri",function(){return b.getService("window").getDefaultBaseUri()}),new y("inline",!1)]).parse(e),this._window=null}return f(t,null,[{key:"registerPlugin",value:function(t){O.addPlugin(t)}},{key:"registerPreset",value:function(t){O.addPreset(t)}},{key:"use",value:function(t){b.setService(t.getName(),t)}}]),f(t,[{key:"convert",value:function(t){if(!t)return"";var e=this.document,n=void 0;"string"==typeof t?(n=e.createElement("div")).innerHTML=t:n=t;var r=new w(this,this._options,O),i=void 0;e.contains(n)||((i=e.createElement("div")).style.display="none",i.appendChild(n),e.body.appendChild(i));try{O.invokePlugins("startConversion",r),r.convertElement(n),O.invokePlugins("endConversion",r)}finally{i&&(e.body.removeChild(i),i.removeChild(n))}return r.toString()}},{key:"release",value:function(){return this._window&&(b.getService("window").closeWindow(this._window),this._window=null),this}},{key:"document",get:function(){return this.window.document}},{key:"window",get:function(){return this._window||(this._window=b.getService("window").getWindow(this._options.baseUri)),this._window}}]),t}();L.registerPreset(a);var S=L,I=function(){function t(){l(this,t)}return f(t,[{key:"getName",value:function(){}}]),t}(),N=function(t){function e(){return l(this,e),h(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return p(e,I),f(e,[{key:"closeWindow",value:function(t){this.isCloseable(t)&&t.close()}},{key:"getDefaultBaseUri",value:function(){}},{key:"getName",value:function(){return"window"}},{key:"getWindow",value:function(t){}},{key:"isCloseable",value:function(t){return!1}}]),e}(),C=function(t){function e(){return l(this,e),h(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return p(e,N),f(e,[{key:"getDefaultBaseUri",value:function(){return window.document.baseURI}},{key:"getWindow",value:function(t){return window}}]),e}();return S.use(new C),S});
//# sourceMappingURL=europa.min.js.map
