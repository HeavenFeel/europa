/*! Europa v4.0.0 | (C) 2018 Alasdair Mercer, !ninja | MIT License */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Europa=t()}(this,function(){"use strict";var e=function(){},t=Object.prototype.hasOwnProperty,n=Array.prototype.slice;function r(e,r,i){for(var o,a,u=0,s=(i=n.call(arguments,2)).length;u<s;u++)for(o in a=i[u])e&&!t.call(a,o)||(r[o]=a[o])}var i=function(t,n,i,o){var a=this;return"string"!=typeof t&&(o=i,i=n,n=t,t=null),"function"!=typeof n&&(o=i,i=n,n=function(){return a.apply(this,arguments)}),r(!1,n,a,o),n.prototype=function(t,n){var i;return"function"==typeof Object.create?i=Object.create(t):(e.prototype=t,i=new e,e.prototype=null),n&&r(!0,i,n),i}(a.prototype,i),n.prototype.constructor=n,n.class_=t||a.class_,n.super_=a,n};function o(){}o.class_="Nevis",o.super_=Object,o.extend=i;var a=o,u=a.extend(null,{forOwn:function(e,t,n){if(e)for(var r in e)u.hasOwn(e,r)&&t.call(n,e[r],r,e)},hasOwn:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},leftPad:function(e,t,n){if(null==e&&(e=""),null==t&&(t=0),null==n&&(n=" "),!n)return e;for(var r=0;r<t;r++)e=n+e;return e}}),s=u,c=a.extend(function(e,t){this.europa=e,this.options=t,this.atLeft=!0,this.atNoWhiteSpace=!0,this.atParagraph=!0,this.buffer="",this.context={},this.inCodeBlock=!1,this.inOrderedList=!1,this.inPreformattedBlock=!1,this.last=null,this.left="\n",this.listDepth=0,this.listIndex=1,this._document=e.document,this._element=null,this._tagName=null,this._window=e.window},{append:function(e){return null!=this.last&&(this.buffer+=this.last),this.last=e,this},appendParagraph:function(){return this.atParagraph?this:(this.atLeft||(this.append(this.left),this.atLeft=!0),this.append(this.left),this.atNoWhiteSpace=!0,this.atParagraph=!0,this)},output:function(e,t){return e?(e=e.replace(/\r\n/g,"\n"),t&&(e=e.replace(/\n([ \t]*\n)+/g,"\n").replace(/\n[ \t]+/g,"\n").replace(/[ \t]+/g," "),s.forOwn(c.replacements,function(t,n){e=e.replace(c.replacementsRegExp[n],t)})),this.inPreformattedBlock||(e=this.atNoWhiteSpace?e.replace(/^[ \t\n]+/,""):/^[ \t]*\n/.test(e)?e.replace(/^[ \t\n]+/,"\n"):e.replace(/^[ \t]+/," ")),e?(this.atLeft=/\n$/.test(e),this.atNoWhiteSpace=/[ \t\n]$/.test(e),this.atParagraph=/\n{2}$/.test(e),this.append(e.replace(/\n/g,this.left))):this):this},replaceLeft:function(e){return this.atLeft?this.last&&(this.last=this.last.replace(/[ ]{2,4}$/,e)):(this.append(this.left.replace(/[ ]{2,4}$/,e)),this.atLeft=!0,this.atNoWhiteSpace=!0,this.atParagraph=!0),this}},{replacements:{"\\\\":"\\\\","\\[":"\\[","\\]":"\\]",">":"\\>",_:"\\_","\\*":"\\*","`":"\\`","#":"\\#","([0-9])\\.(\\s|$)":"$1\\.$2","©":"(c)","®":"(r)","™":"(tm)"," ":" ","·":"\\*"," ":" "," ":" "," ":" ","‘":"'","’":"'","“":'"',"”":'"',"…":"...","–":"--","—":"---"},replacementsRegExp:{}});Object.defineProperties(c.prototype,{document:{get:function(){return this._document}},element:{get:function(){return this._element},set:function(e){this._element=e,this._tagName=e&&e.tagName?e.tagName.toLowerCase():null}},tagName:{get:function(){return this._tagName}},window:{get:function(){return this._window},set:function(e){this._window=e,this._document=e?e.document:null}}}),s.forOwn(c.replacements,function(e,t){c.replacementsRegExp[t]=new RegExp(t,"g")});var f=c,p=a.extend(null,{isVisible:function(e,t){var n=t.getComputedStyle(e);return"none"!==n.getPropertyValue("display")&&"hidden"!==n.getPropertyValue("visibility")}}),l=a.extend(function(e,t){this.name=e,this._defaultValue=t});Object.defineProperty(l.prototype,"defaultValue",{get:function(){var e=this._defaultValue;return"function"==typeof e?e.call(this):e}});var d=l,h=a.extend(function(e){this.options=e},{exists:function(e){return this.options.some(function(t){return t.name===e})},parse:function(e){e||(e={});var t={};return this.options.forEach(function(n){var r=n.name,i=null!=e[r]?e[r]:n.defaultValue;t[r]=i}),t}}),g=a.extend({after:function(e,t){},afterAll:function(e){},before:function(e,t){},beforeAll:function(e){},convert:function(e,t){return!0},getTagNames:function(){return[]}}),v={},m=new(a.extend(function(){this._services={}},{getService:function(e){var t=this._services[e];if(!t)throw new Error("Service is not being managed with name: "+e);return t},setService:function(e,t){if(this._services[e])throw new Error("Service is already managed with name: "+e);t&&(this._services[e]=t)}})),w=a.extend(function(e){this._options=new h([new d("absolute",!1),new d("baseUri",function(){return m.getService("window").getDefaultBaseUri()}),new d("inline",!1)]).parse(e),this._window=null},{convert:function(e){if(!e)return"";var t,n=this.document;"string"==typeof e?(t=n.createElement("div")).innerHTML=e:t=e;var r,i=new f(this,this._options);n.contains(t)||((r=n.createElement("div")).style.display="none",r.appendChild(t),n.body.appendChild(r));try{s.forOwn(v,function(e){e.beforeAll(i)}),this.convertElement(t,i),s.forOwn(v,function(e){e.afterAll(i)})}finally{r&&(n.body.removeChild(r),r.removeChild(t))}return i.append("").buffer.trim()},convertElement:function(e,t){if(e){var n,r,i,o,a=!1,u=this.window;if(e.nodeType===u.Node.ELEMENT_NODE){if(!p.isVisible(e,u))return;if(t.element=e,n={},a=!0,(i=v[t.tagName])&&(i.before(t,n),a=i.convert(t,n)),a)for(r=0;r<e.childNodes.length;r++)this.convertElement(e.childNodes[r],t);i&&i.after(t,n)}else e.nodeType===u.Node.TEXT_NODE&&(o=e.nodeValue||"",t.inPreformattedBlock?t.output(o):t.inCodeBlock?t.output(o.replace(/`/g,"\\`")):t.output(o,!0))}},release:function(){return this._window&&(m.getService("window").closeWindow(this._window),this._window=null),this}},{Plugin:g,register:function(e){e.getTagNames().forEach(function(t){v[t]=e})},use:function(e){m.setService(e.getName(),e)}});Object.defineProperties(w.prototype,{document:{get:function(){return this.window.document}},window:{get:function(){return this._window||(this._window=m.getService("window").getWindow(this._options.baseUri)),this._window}}});var x=w,b=g.extend({after:function(e,t){null!=t.value&&e.output("]"+t.value)},afterAll:function(e){var t=e.context.anchors;if(t.length){e.append("\n\n");for(var n=0;n<t.length;n++)e.append("[anchor"+n+"]: "+t[n]+"\n")}},beforeAll:function(e){e.context.anchorMap={},e.context.anchors=[]},convert:function(e,t){var n=e.element,r=e.options,i=r.absolute?n.href:n.getAttribute("href");if(!i)return!0;var o,a=e.context.anchorMap,u=e.context.anchors,s=n.getAttribute("title"),c=s?i+' "'+s+'"':i;return r.inline?t.value="("+c+")":(null==(o=a[c])&&(o=u.push(c)-1,a[c]=o),t.value="[anchor"+o+"]"),e.output("["),e.atNoWhiteSpace=!0,!0},getTagNames:function(){return["a"]}});x.register(new b);var N=g.extend({after:function(e,t){e.atLeft=!1,e.atParagraph=!1,e.left=t.previousLeft,e.appendParagraph()},before:function(e,t){t.previousLeft=e.left},convert:function(e,t){return e.left+="> ",e.atParagraph?e.append("> "):e.appendParagraph(),!0},getTagNames:function(){return["blockquote","dd"]}});x.register(new N);var y=g.extend({convert:function(e,t){return e.append("  "+e.left),e.atLeft=!0,e.atNoWhiteSpace=!0,!1},getTagNames:function(){return["br"]}});x.register(new y);var P=g.extend({after:function(e,t){t.skipped||(e.inCodeBlock=t.previousInCodeBlock,e.output("`"))},before:function(e,t){t.previousInCodeBlock=e.inCodeBlock},convert:function(e,t){return e.inPreformattedBlock?t.skipped=!0:(e.output("`"),e.inCodeBlock=!0),!0},getTagNames:function(){return["code","kbd","samp"]}});x.register(new P);var _=g.extend({after:function(e,t){e.output("**")},convert:function(e,t){return e.appendParagraph(),e.output("**"),e.atNoWhiteSpace=!0,!0},getTagNames:function(){return["dt"]}});x.register(new _);var L=g.extend({convert:function(e,t){var n=e.element;if(e.appendParagraph(),n.hasAttribute("open"))return!0;var r=n.querySelector("summary");return e.europa.convertElement(r,e),!1},getTagNames:function(){return["details"]}});x.register(new L);var O=g.extend({after:function(e,t){e.output("_")},convert:function(e,t){return e.output("_"),e.atNoWhiteSpace=!0,!0},getTagNames:function(){return["cite","dfn","em","i","u","var"]}});x.register(new O);var T=g.extend({convert:function(e,t){return!1},getTagNames:function(){return["applet","area","audio","button","canvas","datalist","embed","head","input","map","menu","meter","noframes","noscript","object","optgroup","option","param","progress","rp","rt","ruby","script","select","style","textarea","title","video"]}});x.register(new T);var E=g.extend({after:function(e,t){e.window=t.previousWindow},before:function(e,t){t.previousWindow=e.window},convert:function(e,t){var n=e.element.contentWindow;return n&&(e.window=n,e.europa.convertElement(n.document.body,e)),!1},getTagNames:function(){return["frame","iframe"]}});x.register(new E);var I=g.extend({convert:function(e,t){var n=parseInt(e.tagName.match(/([1-6])$/)[1],10);e.appendParagraph();for(var r="",i=0;i<n;i++)r+="#";return e.output(r+" "),!0},getTagNames:function(){return["h1","h2","h3","h4","h5","h6"]}});x.register(new I);var S=g.extend({convert:function(e,t){return e.appendParagraph().output("---").appendParagraph(),!1},getTagNames:function(){return["hr"]}});x.register(new S);var W=g.extend({afterAll:function(e){var t=e.context.images;if(t.length){e.append("\n\n");for(var n=0;n<t.length;n++)e.append("[image"+n+"]: "+t[n]+"\n")}},beforeAll:function(e){e.context.imageMap={},e.context.images=[]},convert:function(e,t){var n=e.element,r=e.options,i=r.absolute?n.src:n.getAttribute("src");if(!i)return!1;var o,a=n.getAttribute("alt")||"",u=e.context.imageMap,s=e.context.images,c=n.getAttribute("title"),f=c?i+' "'+c+'"':i;return r.inline?f="("+f+")":(null==(o=u[f])&&(o=s.push(f)-1,u[f]=o),f="[image"+o+"]"),e.output("!["+a+"]"+f),!1},getTagNames:function(){return["img"]}});x.register(new W);var k=g.extend({convert:function(e,t){var n=e.inOrderedList?e.listIndex+++". ":"* ";return e.atLeft?e.last&&(e.last=e.last.replace(/[ ]{2,4}$/,"\n")):(e.append(e.left.replace(/[ ]{2,4}$/,"\n")),e.atLeft=!0,e.atNoWhiteSpace=!0,e.atParagraph=!0),e.append(s.leftPad(n,2*(e.listDepth-1))),!0},getTagNames:function(){return["li"]}});x.register(new k);var B=g.extend({after:function(e,t){e.inOrderedList=t.previousInOrderedList,e.listIndex=t.previousListIndex,e.listDepth--},before:function(e,t){t.previousInOrderedList=e.inOrderedList,t.previousListIndex=e.listIndex},convert:function(e,t){return 0===e.listDepth&&e.appendParagraph(),e.inOrderedList=!0,e.listIndex=1,e.listDepth++,!0},getTagNames:function(){return["ol"]}});x.register(new B);var A=g.extend({convert:function(e,t){return e.appendParagraph(),!0},getTagNames:function(){return["address","article","aside","div","fieldset","footer","header","nav","p","section"]}});x.register(new A);var C=g.extend({after:function(e,t){e.atLeft=!1,e.atParagraph=!1,e.inPreformattedBlock=t.previousInPreformattedBlock,e.left=t.previousLeft,e.appendParagraph()},before:function(e,t){t.previousInPreformattedBlock=e.inPreformattedBlock,t.previousLeft=e.left},convert:function(e,t){return e.left+="    ",e.atParagraph?e.append("    "):e.appendParagraph(),!0},getTagNames:function(){return["pre"]}});x.register(new C);var D=g.extend({after:function(e,t){e.output('"')},convert:function(e,t){return e.output('"'),e.atNoWhiteSpace=!0,!0},getTagNames:function(){return["q"]}});x.register(new D);var $=g.extend({after:function(e,t){e.output("**")},convert:function(e,t){return e.output("**"),e.atNoWhiteSpace=!0,!0},getTagNames:function(){return["b","strong"]}});x.register(new $);var j=g.extend({after:function(e,t){e.inOrderedList=t.previousInOrderedList,e.listIndex=t.previousListIndex,e.listDepth--},before:function(e,t){t.previousInOrderedList=e.inOrderedList,t.previousListIndex=e.listIndex},convert:function(e,t){return 0===e.listDepth&&e.appendParagraph(),e.inOrderedList=!1,e.listIndex=1,e.listDepth++,!0},getTagNames:function(){return["ul"]}});x.register(new j);var V=x,M=a.extend({getName:function(){}}).extend({closeWindow:function(e){this.isCloseable(e)&&e.close()},getDefaultBaseUri:function(){},getName:function(){return"window"},getWindow:function(e){},isCloseable:function(e){return!1}}).extend({getDefaultBaseUri:function(){return window.document.baseURI},getWindow:function(e){return window}});return V.use(new M),V});
//# sourceMappingURL=europa.min.js.map
