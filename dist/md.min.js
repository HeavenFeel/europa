// [html.md](http://neocotic.com/html.md) 1.0.0
// (c) 2012 Alasdair Mercer
// Freely distributable under the MIT license.
// Based on [Make.text](http://homepage.mac.com/tjim/) 1.5
// (c) 2007 Trevor Jim
// Licensed under the GPL Version 2 license.
// For all details and documentation:
// http://neocotic.com/html.md
(function(){var t,e,i,s,n,r,o,h,a,u,p,c,l,f,d,E={}.hasOwnProperty;t={debug:!1},s=window.md,r={"\\\\":"\\\\","\\[":"\\[","\\]":"\\]",">":"\\>",_:"\\_","\\*":"\\*","`":"\\`","#":"\\#","([0-9])\\.(\\s|$)":"$1\\.$2","©":"(c)","®":"(r)","™":"(tm)"," ":" ","·":"\\*"," ":" "," ":" "," ":" ","‘":"'","’":"'","“":'"',"”":'"',"…":"...","–":"--","—":"---"},o=/^(APPLET|AREA|AUDIO|BUTTON|CANVAS|COMMAND|DATALIST|EMBED|HEAD|INPUT|KEYGEN|MAP|MENU|METER|NOFRAMES|NOSCRIPT|OBJECT|OPTION|PARAM|PROGRESS|SCRIPT|SELECT|SOURCE|STYLE|TEXTAREA|TRACK|VIDEO)$/,h=/^(ADDRESS|ARTICLE|ASIDE|DIV|FOOTER|HEADER|P|SECTION)$/,n=function(){p={};for(a in r)E.call(r,a)&&(c=r[a],p[a]=RegExp(a,"g"));return p}(),i=null!=(l=window.Node)?l:{},null==(f=i.ELEMENT_NODE)&&(i.ELEMENT_NODE=1),null==(d=i.TEXT_NODE)&&(i.TEXT_NODE=3),e=function(){function e(e,i){var s;this.html=null!=e?e:"",this.options=null!=i?i:{},this.atLeft=this.atNoWS=this.atP=!0,this.buffer="",this.exceptions=this.links=this.linkTitles=[],this.inCode=this.inPre=this.inOrderedList=this.parsed=!1,this.last=null,this.left="\n",this.linkCache=this.unhandled={},"object"!=typeof this.options&&(this.options={});for(a in t)E.call(t,a)&&(s=t[a],this.options.hasOwnProperty(a)||(this.options[a]=s))}return e.prototype.append=function(t){return null!=this.last&&(this.buffer+=this.last),this.last=t},e.prototype.br=function(){return this.append("  "+this.left),this.atLeft=this.atNoWS=!0},e.prototype.code=function(){var t,e=this;return t=this.inCode,this.inCode=!0,function(){return e.inCode=t}},e.prototype.inCodeProcess=function(t){return t.replace(/`/g,"\\`")},e.prototype.nonPreProcess=function(t){t=t.replace(/\n([ \t]*\n)+/g,"\n"),t=t.replace(/\n[ \t]+/g,"\n"),t=t.replace(/[ \t]+/g," ");for(a in r)E.call(r,a)&&(c=r[a],t=t.replace(n[a],c));return t},e.prototype.ol=function(){var t,e=this;return t=this.inOrderedList,this.inOrderedList=!0,function(){return e.inOrderedList=t}},e.prototype.output=function(t){return t&&(this.inPre||(t=this.atNoWS?t.replace(/^[ \t\n]+/,""):/^[ \t]*\n/.test(t)?t.replace(/^[ \t\n]+/,"\n"):t.replace(/^[ \t]+/," ")),""!==t)?(this.atP=/\n\n$/.test(t),this.atLeft=/\n$/.test(t),this.atNoWS=/[ \t\n]$/.test(t),this.append(t.replace(/\n/g,this.left))):void 0},e.prototype.outputLater=function(t){var e=this;return function(){return e.output(t)}},e.prototype.p=function(){return this.atP?void 0:(this.atLeft||(this.append(this.left),this.atLeft=!0),this.append(this.left),this.atNoWS=this.atP=!0)},e.prototype.parse=function(){var t,e,i,s,n,r,o,h,a,u=this;if(!this.html)return"";if(this.parsed)return this.buffer;for(t=document.createElement("div"),"string"==typeof this.html?t.innerHTML=this.html:t.appendChild(this.html),this.process(t),this.append("\n\n"),a=this.links,r=function(t,e){var i;return i=u.linkTitles[e]?' "'+u.linkTitles[e]+'"\n':"\n",t?u.append("["+e+"]: "+t+i):void 0},e=o=0,h=a.length;h>o;e=++o)i=a[e],r(i,e);return this.options.debug&&(n=function(){var t,e;t=this.unhandled,e=[];for(s in t)E.call(t,s)&&e.push(s);return e}.call(this).sort(),n.length?console.log("Ignored tags;\n"+n.join(", ")):console.log("No tags were ignored"),this.exceptions.length&&console.log(this.exceptions.join("\n"))),this.append(""),this.parsed=!0,this.buffer=this.buffer.trim()},e.prototype.pre=function(){var t,e=this;return t=this.inPre,this.inPre=!0,function(){return e.inPre=t}},e.prototype.process=function(t){var e,s,n,r,a,u,p,c,l,f,d,E,N,L;if("undefined"!=typeof getComputedStyle&&null!==getComputedStyle)try{if(l=getComputedStyle(t,null),"none"===(null!=l?"function"==typeof l.getPropertyValue?l.getPropertyValue("display"):void 0:void 0))return}catch(T){this.thrown(T,"getComputedStyle")}if(t.nodeType===i.ELEMENT_NODE){c=!1;try{if(o.test(t.tagName))c=!0;else if(/^H[1-6]$/.test(t.tagName))p=parseInt(t.tagName.match(/([1-6])$/)[1]),this.p(),this.output(""+function(){var t,e;for(e=[],a=t=1;p>=1?p>=t:t>=p;a=p>=1?++t:--t)e.push("#");return e}().join("")+" ");else if(h.test(t.tagName))this.p();else switch(t.tagName){case"BODY":case"FORM":break;case"DETAILS":this.p(),null==t.getAttribute("open")&&(c=!0,f=t.getElementsByTagName("summary")[0],f&&this.process(f));break;case"BR":this.br();break;case"HR":this.p(),this.output("--------------------------------"),this.p();break;case"CITE":case"DFN":case"EM":case"I":case"U":case"VAR":this.output("_"),this.atNoWS=!0,e=this.outputLater("_");break;case"DT":case"B":case"STRONG":"DT"===t.tagName&&this.p(),this.output("**"),this.atNoWS=!0,e=this.outputLater("**");break;case"Q":this.output('"'),this.atNoWS=!0,e=this.outputLater('"');break;case"OL":case"PRE":case"UL":s=this.pushLeft("    "),n=function(){switch(t.tagName){case"OL":return this.ol();case"PRE":return this.pre();case"UL":return this.ul()}}.call(this),e=function(){return s(),n()};break;case"LI":this.replaceLeft(this.inOrderedList?"1.  ":"*   ");break;case"CODE":case"KBD":case"SAMP":this.inPre||(this.output("`"),s=this.code(),n=this.outputLater("`"),e=function(){return s(),n()});break;case"BLOCKQUOTE":case"DD":e=this.pushLeft("> ");break;case"A":if(!t.href)break;this.linkCache[t.href]?u=this.linkCache[t.href]:(u=this.links.length,this.links[u]=t.href,this.linkCache[t.href]=u,t.title&&(this.linkTitles[u]=t.title)),this.output("["),this.atNoWS=!0,e=this.outputLater("]["+u+"]");break;case"IMG":if(c=!0,!t.src)break;this.output("!["+t.alt+"]("+t.src+")");break;case"FRAME":case"IFRAME":c=!0;try{(null!=(N=t.contentDocument)?N.documentElement:void 0)&&this.process(t.contentDocument.documentElement)}catch(T){this.thrown(T,"contentDocument")}break;case"TR":e=this.p;break;default:this.options.debug&&(this.unhandled[t.tagName]=null)}}catch(T){this.thrown(T,t.tagName)}if(!c)for(L=t.childNodes,d=0,E=L.length;E>d;d++)r=L[d],this.process(r);return"function"==typeof e?e():void 0}return t.nodeType===i.TEXT_NODE?this.inPre?this.output(t.nodeValue):this.inCode?this.output(this.inCodeProcess(t.nodeValue)):this.output(this.nonPreProcess(t.nodeValue)):void 0},e.prototype.pushLeft=function(t){var e,i=this;return e=this.left,this.left+=t,this.atP?this.append(t):this.p(),function(){return i.left=e,i.atLeft=i.atP=!1,i.p()}},e.prototype.replaceLeft=function(t){return this.atLeft?this.last?this.last=this.last.replace(/[ ]{4}$/,t):void 0:(this.append(this.left.replace(/[ ]{4}$/,t)),this.atLeft=this.atNoWS=this.atP=!0)},e.prototype.thrown=function(t,e){return this.options.debug?this.exceptions.push(""+e+": "+t):void 0},e.prototype.ul=function(){var t,e=this;return t=this.inOrderedList,this.inOrderedList=!1,function(){return e.inOrderedList=t}},e}(),u=window.md=function(t,i){return new e(t,i).parse()},u.VERSION="1.0.0",u.noConflict=function(){return window.md=s,this}}).call(this);